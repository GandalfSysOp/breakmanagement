<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Break Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  min-height: 100vh;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

.card {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px);
  border-radius: 20px;
  border: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  width: 100%;
  max-width: 500px;
}

.clock {
  font-size: 2.6rem;
  letter-spacing: 2px;
  font-weight: 600;
}

.sub {
  font-size: 0.9rem;
  opacity: 0.7;
}

#timer {
  display:none;
  font-size:1.4rem;
  margin-top:8px;
}

table {
  color:#fff;
}

thead {
  font-size:0.8rem;
  opacity:0.7;
}
</style>
</head>
<body>

<div class="card p-4 text-center">

  <h3 id="userName"></h3>

  <div class="sub">New Delhi (IST)</div>
  <div id="digitalClock" class="clock">--:--:--</div>

  <div id="timer" class="text-info">00:00:00.000</div>

  <div class="mt-3">
    <button id="outBtn" class="btn btn-danger btn-lg px-5">Out</button>
    <button id="inBtn" class="btn btn-success btn-lg px-5 d-none">In</button>
  </div>

  <div id="status" class="mt-2 small"></div>

  <hr class="my-3">

  <h6 class="mb-2">Last 10 Breaks</h6>

  <div class="table-responsive">
  <table class="table table-sm table-borderless">
    <thead>
      <tr><th>Out</th><th>In</th><th>Duration</th></tr>
    </thead>
    <tbody id="logs"></tbody>
  </table>
  </div>

</div>

<script>
/* CONFIG */
const USER_NAME = "Vivek"; // change for Sapna
const API_URL = "https://script.google.com/macros/s/AKfycbwxzDHrkVACW3Yhck9AFHkLh8m2zPNghQj1vdyYwNHVG1tsv6M4SJI1GwUUpCpWYzKpzw/exec";

/* Elements */
const outBtn = document.getElementById("outBtn");
const inBtn = document.getElementById("inBtn");
const timerDiv = document.getElementById("timer");
const statusDiv = document.getElementById("status");
document.getElementById("userName").innerText = USER_NAME;

/* Digital Clock */
function updateClock() {
  const now = new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));
  document.getElementById("digitalClock").innerText =
    now.toLocaleTimeString("en-IN",{hour12:false});
}
setInterval(updateClock,1000);
updateClock();

/* Timer */
let startPerf=0, timerInt=null;

function formatDuration(ms){
  const h=Math.floor(ms/3600000);
  const m=Math.floor((ms%3600000)/60000);
  const s=Math.floor((ms%60000)/1000);
  const ms2=Math.floor(ms%1000);
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${String(ms2).padStart(3,'0')}`;
}

function startTimer(){
  startPerf=performance.now();
  timerDiv.style.display="block";
  timerInt=setInterval(()=>{
    timerDiv.innerText=formatDuration(performance.now()-startPerf);
  },10);
}

function stopTimer(){
  clearInterval(timerInt);
  timerDiv.style.display="none";
}

/* POST (no-cors) */
async function send(action){
  statusDiv.innerText="Saving...";
  try{
    await fetch(API_URL,{
      method:"POST",
      mode:"no-cors",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        name:USER_NAME,
        action,
        timestamp:new Date().toISOString()
      })
    });
    statusDiv.innerText="✓ Saved";
    loadLogs();
  }catch{
    statusDiv.innerText="❌ Failed";
  }
}

outBtn.onclick=async()=>{
  await send("out");
  outBtn.classList.add("d-none");
  inBtn.classList.remove("d-none");
  startTimer();
};

inBtn.onclick=async()=>{
  await send("in");
  inBtn.classList.add("d-none");
  outBtn.classList.remove("d-none");
  stopTimer();
};

/* JSONP logs */
function loadLogs(){
  const cb="cb_"+Math.random().toString(36).slice(2);
  const s=document.createElement("script");

  window[cb]=function(data){
    const body=document.getElementById("logs");
    body.innerHTML="";
    data.forEach(r=>{
      body.innerHTML+=`
      <tr>
        <td>${r[1]||""}</td>
        <td>${r[2]||""}</td>
        <td>${r[3]||""}</td>
      </tr>`;
    });
    delete window[cb];
    s.remove();
  };

  s.src=`${API_URL}?action=logs&name=${USER_NAME}&callback=${cb}`;
  document.body.appendChild(s);
}

loadLogs();
</script>
</body>
</html>

